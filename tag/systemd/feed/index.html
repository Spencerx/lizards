<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>systemd &#8211; openSUSE Lizards</title>
	<atom:link href="https://lizards.opensuse.org/tag/systemd/feed/" rel="self" type="application/rss+xml" />
	<link>https://lizards.opensuse.org</link>
	<description>Blogs and Ramblings of the openSUSE Members</description>
	<lastBuildDate>Fri, 06 Mar 2020 11:29:40 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.7.5</generator>
	<item>
		<title>It&#8217;s hoolihoolihooliday and what fun I can do?</title>
		<link>https://lizards.opensuse.org/2014/12/16/its-hoolihoolihooliday-and-what-fun-i-can-do/</link>
		<pubDate>Tue, 16 Dec 2014 06:28:36 +0000</pubDate>
		<dc:creator><![CDATA[Tuukka Pasanen]]></dc:creator>
				<category><![CDATA[Miscellaneous]]></category>
		<category><![CDATA[13.2]]></category>
		<category><![CDATA[2014]]></category>
		<category><![CDATA[chrome]]></category>
		<category><![CDATA[Linux]]></category>
		<category><![CDATA[systemd]]></category>
		<category><![CDATA[Tumbleweed]]></category>

		<guid isPermaLink="false">http://lizards.opensuse.org/?p=11109</guid>
		<description><![CDATA[I know I&#8217;m old losah! Nowadays it&#8217;s all about pads, phones and mobile this and mobile that. Install some cool stuff from app store and start mangling. I was amused how much you can do with these small entertainment units but then comes small detail that is not that cool over 20% stuff that is [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>I know <a title="Losah" href="http://www.urbandictionary.com/define.php?term=Losah">I&#8217;m old losah</a>! Nowadays it&#8217;s all about pads, phones and mobile this and mobile that. Install some cool stuff from app store and start mangling. I was amused how much you can do with these small entertainment units but then comes small detail that is not that cool <a title="Most popular Apple App Store categories in September 2014, by share of available apps" href="http://www.statista.com/statistics/270291/popular-categories-in-the-app-store/">over 20% stuff that is downloaded from Apple store is games and those neat utilities are just 5%</a>. I don&#8217;t know what education means but it&#8217;s after games so I think it&#8217;s good thing. What I&#8217;m trying to say stop playing for a while (it&#8217;s good thing to do. Don&#8217;t get me wrong), put pad/phone down and look around what kind of world we are living in 2014.</p>
<h2>Nah Open Source/Free Software doesn&#8217;t matter anyway</h2>
<p>In year 2014 wasn&#8217;t just year on Linux getting <a title=" Tech More: Apple Android iOS Google The iPhone 6 Had Better Be Amazing And Cheap, Because Apple Is Losing The War To Android  Read more: http://www.businessinsider.com/iphone-v-android-market-share-2014-5" href="http://www.businessinsider.com/iphone-v-android-market-share-2014-5?IR=T">into you hands as Android</a>. It was strange year in Linux land. Probably biggest Linux hater from Redmond that called <a title="Linux is cancer" href="http://www.theregister.co.uk/2001/06/02/ballmer_linux_is_a_cancer/">Linux Cancer</a> said &#8216;<a title="Microsoft: It's TIME at LAST. Yes - .NET is going OPEN and X-PLATFORM" href="http://www.theregister.co.uk/2014/11/12/microsoft_to_open_source_dot_net/">hey Free Software and Open Source are cool!</a> <a title="Audio nerds rejoice: Windows 10 will get support for playing FLAC files next year" href="http://venturebeat.com/2014/11/26/windows-10-will-get-flac-support-next-year-on-top-of-mkv-and-hevc-additions/">We take cherrys</a> like Apple and sell them to you in nice package and there nothing wrong with that (And I&#8217;m with them.. it&#8217;s what they can do if you buy it)&#8217;. Small IoT (Internet-Of-Things, Industrial Internet or choose your favorite term) ARM SOC boards are so Nineties. MIPS made proud comeback! <a title="MIPS instruction set" href="http://en.wikipedia.org/wiki/MIPS_instruction_set">Once it was SGI&#8217;s own bitch</a> but now there is <a title="MIPS Takes on ARM in the Internet of Things" href="http://www.linux.com/news/embedded-mobile/mobile-linux/777166-mips-takes-on-arm-internet-of-things/">growing mass of small very cheap wireless boards started to flow in</a>. All supporting Linux and most have also Android. Targeted to next big thing that you are doing when not playing.</p>
<p>In Finland where I&#8217;m located this have been year of economical rumble (read economical crash). Mass layoffs, industrial work places are getting rare and <a title="Microsoft officially welcomes the Nokia Devices and Services business" href="http://news.microsoft.com/2014/04/25/microsoft-officially-welcomes-the-nokia-devices-and-services-business/">Nokia was sold to that huge firm from Redmond</a>. Selling Nokia out was end of Finland&#8217;s mobile dreams as they <a title="Nokia N1" href="http://n1.nokia.com/en">now have new tablet</a> and fear not also <a title="Be a part of making the world’s first people powered tablet, running Sailfish OS 2.0" href="https://www.indiegogo.com/projects/jolla-tablet-world-s-first-crowdsourced-tablet">Jolla is launching their new shiny Sailfish tablet</a> and got very good funding through indie-go-go. Ok nobody really wants this tablet because of Android but it&#8217;s good to see there is guys and girls that still think with punk attitude and believe that very small firm like Jolla can produce something that big players can&#8217;t.</p>
<p>Year 2014 also was big climate is changing year. USA and China make promise to cut their <a title="US and China strike deal on carbon cuts in push for global climate change pact " href="http://www.theguardian.com/environment/2014/nov/12/china-and-us-make-carbon-pledge">carbon dioxide emission till 2030</a>. USA will do something and China says their peak will be 2030. Does this stop global warming probably not but at least now it&#8217;s official that climate is changing. How this is relevant with Linux? <a title="Supercomputer Update: Climate Models and a CO2 Snapshot " href="http://climatecrocks.com/2014/11/22/supercomputer-update-climate-models-and-a-co2-snapshot/">Most of these calculation are done in &#8216;super computers&#8217;</a> and those <a title="Linux dominates supercomputers as never before" href="http://www.zdnet.com/article/linux-dominates-supercomputers-as-never-before/">run tadaaaa&#8230; Linux</a>. They don&#8217;t run Fedora or openSUSE because they are mostly very fast calculators but they run Linux kernel and something that as immortals never will know because most of them doesn&#8217;t calculate climate change things. They calculate nuclear war scenarios. <a title="War games" href="http://www.imdb.com/title/tt0086567/quotes">Hello Dr. Falken shall we play a game</a>? <a title="HP’s ‘The Machine’ &amp; the Future of Linux" href="http://fossforce.com/2014/12/hps-the-machine-the-future-of-linux/">Linux++ and HP Machine anyone</a>?</p>
<p>Firefox which is <a title="As Firefox turns 10, Mozilla introduces new ‘Forget Button’ and launches Developer Edition browser" href="http://thenextweb.com/dd/2014/11/10/firefox-turns-10-mozilla-introduces-new-forget-button-launches-developer-focused-browser/">now 10 years</a> old. They broke up with Google because as you can see they don&#8217;t need that search flow anymore. Firefox <a title="New Search Strategy for Firefox: Promoting Choice &amp; Innovation" href="https://blog.mozilla.org/blog/2014/11/19/promoting-choice-and-innovation-on-the-web/">preset for searching in USA is now Yahoo, Russian Yandex and China Baidu</a>. Mozilla also made bold moves with <a title="Firefox OS" href="https://www.mozilla.org/en-US/firefox/os/">Firefox OS</a> in 2014. <a title="List of Firefox OS devices" href="http://en.wikipedia.org/wiki/List_of_Firefox_OS_devices">More phones</a> and if you need low end cheap phone so <a title="With Firefox OS, Mozilla begins the $25 smartphone push" href="http://www.cnet.com/news/with-firefox-os-mozilla-begins-the-25-smartphone-push/">you should consider Firefox OS phone 25$ that is very cheap</a>.</p>
<h2>So what happened in Linux land</h2>
<p>openSUSE made only <a title="openSUSE Roadmap" href="https://en.opensuse.org/openSUSE:Roadmap">one release 13.2</a> but then rumbled big changes in. openSUSE is also catching up popular rolling release method like Arch Linux with Tumbleweed but this year openSUSE<a title="Factory moves to Rolling Release Development Model" href="https://news.opensuse.org/2014/07/29/factory-rolling-release/"> upstream Factory also become a rolling release</a> and then<a title="openSUSE Factory &amp; Tumbleweed Are Merging" href="http://www.phoronix.com/scan.php?page=news_item&amp;px=MTgyMjA"> it get together with Tumbleweed</a>. It&#8217;s good thing! Really things get tested and traditional releases are more stable. Hooray for that. There was and gigantic war against <a title="XLennart" href="https://github.com/Xylemon/xlennart">systemd</a> and you can start sending me millions of hate mails for a start because<strong> I Like it</strong>! It&#8217;s modern and does everything that was wrong with Linux init. No more big tune this tune that complex learn curve up to your a** stuff very neat simple configuration. Ok it&#8217;s bloat.. but why don&#8217;t you start hating Linux kernel. It&#8217;s not very UNIX nether it&#8217;s doesn&#8217;t just one thing like BSD micro-kernel approach. But that is what I wanted to say about that. If you fork <a title="Devuan" href="https://devuan.org/">Debian just to have Sysvinit</a> I think you are little bit over reacting but best luck to you I&#8217;m nothing but thumbs up get it rolling! At the end this feels like Pulseaudio hating campaign. Everybody hated it first but now nobody even notices that they are using it.</p>
<p>Also it <a title="Can we please stop talking about the Linux desktop?" href="http://www.techrepublic.com/article/can-we-please-stop-talking-about-the-linux-desktop/">becomes clear 2014 that Desktop Linux will never come</a>. Time just passed by and people moved to other things and we have desktop Linux <a title="Best Chromebooks 2014" href="http://blog.laptopmag.com/best-chromebooks">Google&#8217;s Chromebooks</a>. In year 2014 <a title="No, you didn’t miss it: Samsung’s Tizen phone delayed yet again" href="http://www.digitaltrends.com/mobile/samsung-z1-tizen-launch/">It also becomes clear that nor Tizen</a> or <a title="Ubuntu Phone" href="http://www.ubuntu.com/phone">Ubuntu phone</a> will be huge success at least it takes little bit longer. My hope is that X will die in great crash of meteorite or let me rephrase how about <a title="Wayland news 2014" href="http://www.phoronix.com/scan.php?page=news_topic&amp;q=Wayland">Wayland project</a> will never take X-windows place and things never become sweet again. Canonical  shiny move with <a title="Mir Display Server" href="http://unity.ubuntu.com/mir/">Mir display server</a> will shake things up if it becomes successful. Time will tell how things end up will Mir be successor of X or should it be Wayland?</p>
<h2>So what to give as present if you want to give Linux based device?</h2>
<p>There is so many Linux gift list to choose from that I just link to them so you <a title="10 nerdiest Linux gadgets" href="http://www.networkworld.com/article/2291882/linux/151855-10-nerdiest-Linux-gadgets.html">can</a> <a title="2014 Holiday Gift Guide for open source enthusiasts" href="http://www.reddit.com/r/linux/comments/2ndpdp/2014_holiday_gift_guide_for_open_source/">choose</a> <a title="The Geek's Guide to the Coolest Holiday Gifts" href="http://www.linuxjournal.com/content/geek-gift-guide">from</a> <a title="For the Linux nerd who has everything" href="http://www.networkworld.com/article/2851461/linux/the-linux-holiday-shopping-guide.html">yourself</a>.</p>
<p>This was how I see year 2014. Let&#8217;s meet interesting year 2015 which is just few weeks away and light will come back and darkness fade away.</p>
]]></content:encoded>
			</item>
		<item>
		<title>Optimizing a boot time, aka 2 second boot</title>
		<link>https://lizards.opensuse.org/2012/07/26/optimizing-a-boot-time-aka-2-second-boot/</link>
		<comments>https://lizards.opensuse.org/2012/07/26/optimizing-a-boot-time-aka-2-second-boot/#comments</comments>
		<pubDate>Thu, 26 Jul 2012 13:30:07 +0000</pubDate>
		<dc:creator><![CDATA[Michal Vyskocil]]></dc:creator>
				<category><![CDATA[Base System]]></category>
		<category><![CDATA[Hackweek]]></category>
		<category><![CDATA[Usability]]></category>
		<category><![CDATA[12.2]]></category>
		<category><![CDATA[systemd]]></category>

		<guid isPermaLink="false">http://lizards.opensuse.org/?p=8868</guid>
		<description><![CDATA[During the hackweek, I have decided to take a look onto a boot process to realize, how fast can be boot of the system. This metric is considered as a not important, especially in a geek community. But I am sure that this is an important part of user experience. Following text is mean to [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>During the <a title="hackweek" href="http://en.opensuse.org/Portal:Hackweek">hackweek</a>, I have decided to take a look onto a boot process to realize, how fast can be boot of the system. This metric is considered as a not important, especially in a geek community. But I am sure that this is an important part of user experience. Following text is mean to share my investigations with you &#8211; but you should be aware what you are doing, since I have been focused on reducing the boot time as much as possible.</p>
<h2>A bit of theory</h2>
<p>Basically you have three possibilities how to make your boot fast.</p>
<ol>
<li>Start things in a <strong>parallel.</strong></li>
<li>Start things <strong>on demand.</strong></li>
<li>Start <strong>less</strong> things.</li>
</ol>
<h2>&#8230; root of all evil &#8230;</h2>
<blockquote><p>&#8220;Premature optimization is the root of all evil.&#8221;</p></blockquote>
<p>And I will modestly extend Donald Knuth&#8217;s sentence, that the <strong>blind</strong> optimization as well. So if we have to optimize something, we have to know what to do. Fortunately <tt>systemd</tt> comes with an excellent tool called <tt>systemd-analyze</tt>, which show us our boot in several ways.</p>
<p>The simple run of command prints the time we spent in a boot and in which phase.</p>
<pre># systemd-analyze
Startup finished in 8480ms (kernel) + 30873ms (userspace) = 39353ms</pre>
<p>That was the default (minimal X system) 12.2 installation on my EEE 701 netbook, which is probably not suitable to work as nowadays <del>cell</del>smarphone, because is pathetically slow. On the other hand is it a perfect playground, so let&#8217;s continue with an investigating.</p>
<p>The overall time is nice, but won&#8217;t help to know what&#8217;s going on. There are two more subcommands, <code>blame</code> and <code>plot</code> shows us more information about the boot. The first shows the services sorted by the start time. The ones boots so long are those we should kicked off as a first ones.</p>
<p>Let see what slow the boot down a most</p>
<pre>$ systemd-analyze blame | head
 11385ms network.service
  5664ms SuSEfirewall2_init.service
  5575ms systemd-vconsole-setup.service
  3032ms ntp.service
  2840ms remount-rootfs.service
  2230ms postfix.service
  2021ms network-remotefs.service
  1925ms cpufreq.service
  1661ms SuSEfirewall2_setup.service
  1506ms xdm.service</pre>
<p>And take look at the output of <code>systemd-analyze plot</code> command</p>
<p><img src="http://lizards.opensuse.org/wp-content/uploads/2012/07/plot001.gif" alt="openSUSE 12.2 boot diagram" /></p>
<p>You can see, that there is a long chain of <code>SuSEfirewall2_init</code> -&gt; <code>network</code> -&gt; <code>network-remotefs</code> -&gt; <code>SuSEfirewall2_setup</code> tooks several dozen seconds to be finished. And nothing is wrong with that, but that is the server solution, not what I want to have on my tiny laptop.</p>
<h2>Making a laptop boot twice more faster</h2>
<p>So having the complex dependencies of several services in mind, I decided to mask some of them. Masking in systemd world means the service cannot be started using systemd, so it becomes invisible for it. I masked those</p>
<ul>
<li><code>network.service</code> &#8211; will be replaced by NetworkManager, which is more suitable for laptops usage</li>
<li><code>SuSEfirewall2_init</code> and <code>SuSEfirewall2_setup</code> &#8211; even if it&#8217;s a security feature, a risc for laptop, which is mostly offline and running only <code>sshd</code> is pretty small.</li>
<li><code>ntp.service</code>, <code>network-remotefs.service</code> &#8211; those does not makes a sense on my laptop</li>
<li><code>postfix.service</code> &#8211; I do not want to send emails via <code>/usr/bin/sendmail</code></li>
<li><code>cpufreq.service</code> &#8211; it is even not supported by my CPU (grep rc.cpufreq /var/log/messages)</li>
</ul>
<p>Do not forget to install NetworkManager and the applet and change the <code>/etc/sysconfig/network/config</code> and reboot.</p>
<p>Now we have</p>
<pre>
$ systemd-analyze
Startup finished in 8528ms (kernel) + 11123ms (userspace) = 19652ms
</pre>
<h2>Using an strace with systemd</h2>
<p>Now we have a list of worse services</p>
<pre>
$ systemd-analyze blame | head -n 10
  5476ms xdm.service
  4172ms systemd-vconsole-setup.service
  3950ms systemd-modules-load.service
  2781ms remount-rootfs.service
  1848ms NetworkManager.service
  1439ms media.mount
  1426ms systemd-remount-api-vfs.service
  1419ms dev-hugepages.mount
  1411ms dev-mqueue.mount
  1371ms sys-kernel-debug.mount
</pre>
<p>and a proper boot chart</p>
<p><img src="http://lizards.opensuse.org/wp-content/uploads/2012/07/plot002.gif" alt="bootchart w/o network.service" /></p>
<p>It shows us an another botleneck, which is the <code>systemd-vconsole-setup.service</code>, because it delay the <code>sysinit.target</code>, which is very early boot stage. In case like this, we can only use <code>strace</code> to know, what is taking too long. And debugging is pretty straightforward in systemd world. All we have to do is copy service file to<code> /etc/systemd/system</code> and change the <code>ExecStart</code></p>
<pre>
ExecStart=/usr/bin/strace -f -tt -o /run/%N.strace /lib/systemd/systemd-vconsole-setup
</pre>
<p>and reboot. Then you will find the output in <code>/run/systemd-vconsole-setup.strace</code> with a timestamps. Looking there it&#8217;s obvious calling <code>hwinfo --bios</code> is extremely expensive in this stage. You can speedup the unit by setting the <code>KBD_NUMLOCK</code> to yes or no in <code>/etc/sysconfig/keyboard</code>, or you can try to mask it completely I did.</p>
<p>The next service needs to closer look was system-modules-load &#8211; then <code>strace</code> says that it spent 2(!) in <code>init_module()</code> for module <code>microcode</code>. I disabled it as well, even for CPUs needs it can&#8217;t be recommended.</p>
<h2>Native systemd units</h2>
<p>There is one tiny init script called <code>purge-kernels</code>, which starts for 300ms according blame. And in this particular case systemd alternative will be way more effective</p>
<pre>
$ cat /etc/systemd/system/purge-kernels.service
[Unit]
Description=Purge old kernels
After=local_fs.target
ConditionPathExists=/boot/do_pure_kernels

[Service]
Type=oneshot
ExecStart=/sbin/purge-kernels
</pre>
<p>because systemd only do one stat on the file and do not run it at all, so this service disappears from the <code>blame</code> at all.</p>
<h2>The kernel time</h2>
<p>There is one interesting thing about kernel time &#8211; 8 seconds spent there seems to be a lot to me. Simple ls on /boot gave me a pointer</p>
<pre>
$ ls -lh /boot/vmlinuz-* /boot/initrd-*
-rw-r--r-- 1 root root  14M Jul 24 11:03 /boot/initrd-3.4.4-1.1-desktop
-rw-r--r-- 1 root root 4.7M Jul 10 15:48 /boot/vmlinuz-3.4.4-1.1-desktop
</pre>
<p>The <code>initrd</code> is huge, around <strong>three</strong> times bigger than kernel? So let&#8217;s try to find what caused that. Every package can add it&#8217;s own setup script into /lib/mkinitrd/scripts/ thus let ask rpm whose did that</p>
<pre>
$ rpm -qf /lib/mkinitrd/scripts/setup-* | sort -u
cifs-utils-5.5-2.2.2.i586
cryptsetup-1.4.2-3.2.1.i586
device-mapper-1.02.63-26.1.1.i586
dmraid-1.0.0.rc16-18.2.1.i586
kpartx-0.4.9-3.1.1.i586
lvm2-2.02.84-26.1.1.i586
mdadm-3.2.5-3.3.2.i586
mkinitrd-2.7.0-62.2.1.i586
multipath-tools-0.4.9-3.1.1.i586
plymouth-scripts-0.8.5.1-1.3.1.noarch
splashy-0.3.13-35.1.1.i586
</pre>
<p>So I went through a list and try to uninstall things I do not need</p>
<ul>
<li><code>cifs-utils</code> &#8211; if you do not have any windows disc to mount, you can remove, but no impact on initrd size</li>
<li><code>cryptsetup</code> &#8211; this is a popular service for laptops, but I do not have any luks device, so let skip that. It removes a half of Yast as well, so I saved 18M of space, but a little in initrd.</li>
<li><code>device-mapper</code>, <code>dmraid</code>, <code>kpartx</code> and <code>lvm2</code> &#8211; cannot be easily removed as too much low-level stuff depends on it</li>
<li><code>mdadm</code> &#8211; no linux md devides, skip that</li>
<li><code>mkinitrd</code> &#8211; removal can reduce initrd to zero, but we would need own kernel</li>
</li>
<p><code>multipath-tools</code> &#8211; no multipath device, let skip that</li>
<li><code>plymouth-scripts</code> &#8211; who would need the &#8220;fancy&#8221; boot when booting so fast? &#8211; reducing initrd to 8.9M</li>
<li><code>splashy</code> &#8211; the same &#8211; and reducing initrd to 6.6M</li>
</ul>
<p>So the things intended to provide fancy boot actually bloats the system. Let&#8217;s measure the impact of those changes</p>
<pre>
$ systemd-analyze
2781ms (kernel) + 4999ms (userspace) = 7780ms
</pre>
<p><img src="http://lizards.opensuse.org/wp-content/uploads/2012/07/plot003.gif" alt="bootchart w/o network.service" /></p>
<h2>And that&#8217;s all folks &#8230;?</h2>
<p>There are a lot of factors slowing our boot &#8211; reducing it to 8 seconds is not that bad. One have to go carefully through blame and plot output to see what delays his computer in start. I would say making NetworkManager default one at least when installing laptop pattern would be nice and simple change as well as continue on <em>&#8220;systemdifization&#8221;</em> of openSUSE.</p>
<p>There are few other tricks, which get us closer to the target time, but I&#8217;ll post them next day.</p>
]]></content:encoded>
			<wfw:commentRss>https://lizards.opensuse.org/2012/07/26/optimizing-a-boot-time-aka-2-second-boot/feed/</wfw:commentRss>
		<slash:comments>12</slash:comments>
		</item>
	</channel>
</rss>
